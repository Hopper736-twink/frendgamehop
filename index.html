<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PartyGame –®–ø–∏–æ–Ω</title>
<style>
*{box-sizing:border-box}
body{margin:0;height:100vh;font-family:system-ui,Arial;background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);color:#fff;display:flex;justify-content:center;align-items:center;}
#app{width:100%;max-width:420px;padding:20px;}
.card{background:rgba(255,255,255,.12);backdrop-filter:blur(14px);border-radius:22px;padding:20px;box-shadow:0 20px 40px rgba(0,0,0,.45);animation:fade .3s ease;}
h1,h2{text-align:center;margin-top:0}
button{width:100%;padding:14px;margin-top:12px;border:none;border-radius:16px;font-size:16px;background:#ff4ecd;color:white;cursor:pointer;transition:.2s;}
button:hover{transform:scale(1.04)}
input{width:100%;padding:14px;margin-top:12px;border-radius:16px;border:none;font-size:16px;}
.menu button{background:#6c63ff}
.small{opacity:.8;font-size:14px;text-align:center}
@keyframes fade{from{opacity:0;transform:translateY(10px)}to{opacity:1}}
</style>
</head>
<body>
<div id="app"></div>
<script>
const app=document.getElementById("app");

let spyPlayers=[],spyIndex=0,spyTopic=null,roles={},timerDuration=120,timerInterval=null;
let spyWords=[];

// –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ª–æ–≤–∞
fetch("spy_words.json").then(r=>r.json()).then(data=>{spyWords=data;});

// ===== –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é =====
function mainMenu(){
app.innerHTML=`<div class="card menu">
<h1>üéâ PartyGame</h1>
<button onclick="spyMenu()">üïµÔ∏è –®–ø–∏–æ–Ω</button>
<p class="small">–ü–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –ø–æ –∫—Ä—É–≥—É</p>
</div>`;
}

// ===== –®–ø–∏–æ–Ω =====
function spyMenu(){
spyPlayers=[];spyIndex=0;roles={};timerDuration=120;
app.innerHTML=`<div class="card">
<h2>üïµÔ∏è –®–ø–∏–æ–Ω</h2>
<input id="name" placeholder="–ò–º—è –∏–≥—Ä–æ–∫–∞">
<button onclick="addSpyPlayer()">–î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞</button>
<div id="list" class="small"></div>
<input id="time" type="number" placeholder="–í—Ä–µ–º—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö" min="30" max="600">
<button onclick="startSpy()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
<button onclick="mainMenu()">‚¨Ö –ù–∞–∑–∞–¥</button>
</div>`;
}

function addSpyPlayer(){
const n=document.getElementById("name").value.trim();
if(!n) return;
spyPlayers.push(n);
roles[n]="";
document.getElementById("list").innerText=spyPlayers.join(", ");
document.getElementById("name").value="";
}

function startSpy(){
if(spyPlayers.length<3) return alert("–ú–∏–Ω–∏–º—É–º 3 –∏–≥—Ä–æ–∫–∞");
timerDuration=parseInt(document.getElementById("time").value)||120;

// —Å–ª—É—á–∞–π–Ω–∞—è —Ç–µ–º–∞
spyTopic = spyWords[Math.floor(Math.random()*spyWords.length)];

spyIndex=0;
roles[spyPlayers[Math.floor(Math.random()*spyPlayers.length)]]="spy";
nextPlayer();
}

function nextPlayer(){
if(spyIndex>=spyPlayers.length){startRound(); return;}
const name=spyPlayers[spyIndex];
const roleText=roles[name]==="spy" ? "–¢—ã —à–ø–∏–æ–Ω" : "–°–ª–æ–≤–æ: "+spyTopic.word;

app.innerHTML=`<div class="card">
<h2>${name}</h2>
<p id="roleText">–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ä–æ–ª—å</p>
<button onclick="toggleRole('${name}','${roleText}')">–ü–æ–∫–∞–∑–∞—Ç—å/–°–∫—Ä—ã—Ç—å</button>
</div>`;
}

function toggleRole(name,roleText){
const el=document.getElementById("roleText");
if(el.innerText==="–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ä–æ–ª—å"){
el.innerText = roleText;
} else {
spyIndex++;
nextPlayer();
}
}

function startRound(){
let timeLeft=timerDuration;
app.innerHTML=`<div class="card">
<h2>–¢–µ–º–∞: ${spyTopic.word} (${spyTopic.category})</h2>
<p id="timer">${timeLeft}</p>
<p>–ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã, –≤—Ä–µ–º—è —Ç–∏–∫–∞–µ—Ç!</p>
<button onclick="spyWin()">–®–ø–∏–æ–Ω —É–≥–∞–¥–∞–ª</button>
<button onclick="spyLose()">–®–ø–∏–æ–Ω –ø—Ä–æ–∏–≥—Ä–∞–ª</button>
</div>`;

timerInterval=setInterval(()=>{
timeLeft--;
document.getElementById("timer").innerText=timeLeft;
if(timeLeft<=0){clearInterval(timerInterval);spyLose();}
},1000);
}

function spyWin(){clearInterval(timerInterval);alert("–®–ø–∏–æ–Ω —É–≥–∞–¥–∞–ª —Å–ª–æ–≤–æ!");mainMenu();}
function spyLose(){clearInterval(timerInterval);alert("–®–ø–∏–æ–Ω –ø—Ä–æ–∏–≥—Ä–∞–ª!");mainMenu();}

mainMenu();
</script>
</body>
</html>
